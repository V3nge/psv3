<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real SSH in Browser</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .input-container { margin-bottom: 15px; }
        .input-container label { display: block; margin-bottom: 5px; }
        .input-container input { width: 100%; padding: 8px; font-size: 16px; }
        button { padding: 10px 15px; font-size: 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #terminal { margin-top: 20px; width: 100%; height: 400px; }
    </style>
</head>
<body>

<h2>SSH Terminal</h2>

<div class="input-container">
    <label for="ip">IP Address:</label>
    <input type="text" id="ip" placeholder="Enter IP address">
</div>

<div class="input-container">
    <label for="port">Port:</label>
    <input type="text" id="port" placeholder="Enter port (default: 22)">
</div>

<div class="input-container">
    <label for="username">Username:</label>
    <input type="text" id="username" placeholder="Enter username">
</div>

<div class="input-container">
    <label for="password">Password:</label>
    <input type="password" id="password" placeholder="Enter password">
</div>

<button onclick="connectSSH()">Connect</button>

<div id="terminal"></div>

<script src="https://cdn.jsdelivr.net/npm/socket.io-client/dist/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
<script>
    let socket;
    let term;

    function connectSSH() {
        const ip = document.getElementById('ip').value;
        const port = document.getElementById('port').value || 22;
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (!ip || !username || !password) {
            alert('Please fill all the fields');
            return;
        }

        fetch('/ssh/connect', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ ip, port, username, password }),
        })
        .then(response => {
            if (!response.ok) throw new Error('Connection failed');
            return response.json();
        })
        .then(() => {
            setupTerminal();
        })
        .catch(err => {
            console.error('Error:', err);
            alert('Connection failed: ' + err.message);
        });
    }

    function setupTerminal() {
        // Initialize terminal
        term = new Terminal();
        term.open(document.getElementById('terminal'));

        // Establish socket connection to server
        socket = io();  // Connects to the default namespace

        socket.on('output', (data) => {
            term.write(data);  // Write the data from SSH session to the terminal
        });

        // Listen for user input and send to SSH server
        term.onData(data => {
            socket.emit('input', data);  // Send terminal input to the server
        });
    }
</script>

</body>
</html>
